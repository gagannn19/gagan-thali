<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üç≤ Gagan Thali üç≤</title>
<style>
  body {
    background-color: #121212;
    color: #f1f1f1;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
  }
  header {
    background: linear-gradient(90deg, #ff9933, #ffcc00);
    text-align: center;
    padding: 25px;
    font-size: 2.5rem;
    font-weight: bold;
    color: #000;
    letter-spacing: 2px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.5);
  }
  .container {
    max-width: 900px;
    margin: auto;
    padding: 20px;
  }
  .card {
    background: #1e1e1e;
    padding: 25px;
    border-radius: 12px;
    margin-bottom: 20px;
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
  }
  label, input, select, button {
    display: block;
    margin: 12px 0;
  }
  input, select, button {
    padding: 10px;
    border: none;
    border-radius: 5px;
  }
  button {
    background: #ff9933;
    color: #000;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
  }
  button:hover {
    background: #ffcc00;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  th, td {
    border: 1px solid #444;
    padding: 8px;
    text-align: center;
  }
  th {
    background: #333;
  }
  #foodInput {
    width: 70%;
    display: inline-block;
    margin-right: 5px;
  }
  #addFoodBtn {
    display: inline-block;
  }
</style>
</head>
<body>
<header>üç≤ Gagan Thali üç≤</header>
<div class="container">

  <!-- User Details -->
  <div class="card">
    <h2>Enter Your Details</h2>
    <label>Age: <input type="number" id="age"></label>
    <label>Weight (kg): <input type="number" id="weight"></label>
    <label>Height (cm): <input type="number" id="height"></label>
    <label>Gender:
      <select id="gender">
        <option value="male">Male</option>
        <option value="female">Female</option>
      </select>
    </label>
    <label>Do you workout?
      <select id="workout">
        <option value="no">No</option>
        <option value="yes">Yes</option>
      </select>
    </label>
    <button onclick="calculateGoals()">Set Goals</button>
  </div>

  <!-- Goals -->
  <div class="card">
    <h2>Daily Goals</h2>
    <div id="goals">Please enter your details first.</div>
  </div>

  <!-- Food Search -->
  <div class="card">
    <h2>Add Food</h2>
    <input type="text" id="foodInput" placeholder="Enter food (e.g. banana, poha, chicken curry)">
    <button id="addFoodBtn" onclick="searchFood()">Add Food</button>
  </div>

  <!-- Custom Food -->
  <div class="card">
    <h2>Add Custom Food</h2>
    <label>Food Name: <input type="text" id="customName"></label>
    <label>Calories: <input type="number" id="customCalories"></label>
    <label>Protein (g): <input type="number" id="customProtein"></label>
    <label>Carbs (g): <input type="number" id="customCarbs"></label>
    <label>Fat (g): <input type="number" id="customFat"></label>
    <label>Fiber (g): <input type="number" id="customFiber"></label>
    <button onclick="addCustomFood()">Add Custom Food</button>
  </div>

  <!-- Water Tracker -->
  <div class="card">
    <h2>üíß Water Intake</h2>
    <label>Amount (ml): <input type="number" id="waterInput" placeholder="e.g. 250"></label>
    <button onclick="addWater()">Add Water</button>
    <button onclick="resetWater()">Reset</button>
    <div id="waterProgress">Total: 0 ml</div>
  </div>

  <!-- Progress -->
  <div class="card">
    <h2>Progress</h2>
    <div id="progress">No food logged yet.</div>
    <button onclick="resetLog()">Clear All</button>

    <h3>Food Log</h3>
    <table id="foodLogTable" style="display:none;">
      <thead>
        <tr>
          <th>Food</th>
          <th>Calories</th>
          <th>Protein</th>
          <th>Carbs</th>
          <th>Fat</th>
          <th>Fiber</th>
        </tr>
      </thead>
      <tbody id="foodLog"></tbody>
    </table>
  </div>

</div>

<script>
let goals = {calories:0, protein:0, carbs:0, fat:0, fiber:0};
let consumed = {calories:0, protein:0, carbs:0, fat:0, fiber:0};
let water = 0;

const APP_ID = "771ea150";   // Replace with your App ID
const API_KEY = "941908eba34b6154cae788daf378e359"; // Replace with your API Key

// Restore data from localStorage on page load
window.onload = () => {
  const storedConsumed = localStorage.getItem('consumed');
  if(storedConsumed) consumed = JSON.parse(storedConsumed);

  const storedLog = localStorage.getItem('foodLog');
  if(storedLog){
    const logArray = JSON.parse(storedLog);
    logArray.forEach(food => addToLog(food, false));
  }

  const storedWater = localStorage.getItem('water');
  if(storedWater) {
    water = parseInt(storedWater);
    updateWater();
  }

  updateProgress();
}

function calculateGoals(){
  const age = parseInt(document.getElementById("age").value);
  const weight = parseInt(document.getElementById("weight").value);
  const height = parseInt(document.getElementById("height").value);
  const gender = document.getElementById("gender").value;
  const workout = document.getElementById("workout").value;

  let bmr = (gender === "male") ? 10*weight + 6.25*height - 5*age + 5 : 10*weight + 6.25*height - 5*age - 161;
  const activity = (workout === "yes") ? 1.55 : 1.2;
  const calories = Math.round(bmr * activity);

  goals = {
    calories: calories,
    protein: Math.round(weight * 1.8),
    carbs: Math.round((calories*0.5)/4),
    fat: Math.round((calories*0.25)/9),
    fiber: 30
  };

  document.getElementById("goals").innerHTML = `
    Calories: ${goals.calories}<br>
    Protein: ${goals.protein}g<br>
    Carbs: ${goals.carbs}g<br>
    Fat: ${goals.fat}g<br>
    Fiber: ${goals.fiber}g
  `;

  updateProgress();
}

async function searchFood(){
  const query = document.getElementById("foodInput").value;
  if(!query) return alert("Please enter a food name");

  try {
    const response = await fetch("https://trackapi.nutritionix.com/v2/natural/nutrients", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-app-id": APP_ID,
        "x-app-key": API_KEY
      },
      body: JSON.stringify({ query })
    });

    const data = await response.json();

    if(data.foods && data.foods.length > 0){
      const f = data.foods[0];
      const foodItem = {
        name: f.food_name,
        calories: Math.round(f.nf_calories || 0),
        protein: Math.round(f.nf_protein || 0),
        carbs: Math.round(f.nf_total_carbohydrate || 0),
        fat: Math.round(f.nf_total_fat || 0),
        fiber: Math.round(f.nf_dietary_fiber || 0)
      };

      consumed.calories += foodItem.calories;
      consumed.protein += foodItem.protein;
      consumed.carbs += foodItem.carbs;
      consumed.fat += foodItem.fat;
      consumed.fiber += foodItem.fiber;

      addToLog(foodItem);
      updateProgress();
    } else {
      alert("Food not found in database.");
    }
  } catch (err){
    console.error("Error:", err);
    alert("Error fetching nutrition info. Check console.");
  }
}

function addCustomFood(){
  const foodItem = {
    name: document.getElementById("customName").value || "Custom Food",
    calories: parseInt(document.getElementById("customCalories").value) || 0,
    protein: parseInt(document.getElementById("customProtein").value) || 0,
    carbs: parseInt(document.getElementById("customCarbs").value) || 0,
    fat: parseInt(document.getElementById("customFat").value) || 0,
    fiber: parseInt(document.getElementById("customFiber").value) || 0
  };

  consumed.calories += foodItem.calories;
  consumed.protein += foodItem.protein;
  consumed.carbs += foodItem.carbs;
  consumed.fat += foodItem.fat;
  consumed.fiber += foodItem.fiber;

  addToLog(foodItem);
  updateProgress();

  // clear inputs
  document.querySelectorAll("#customName, #customCalories, #customProtein, #customCarbs, #customFat, #customFiber").forEach(el => el.value = "");
}

function addToLog(food, saveConsumed = true){
  const table = document.getElementById("foodLogTable");
  const log = document.getElementById("foodLog");
  table.style.display = "table";

  const row = document.createElement("tr");
  row.innerHTML = `
    <td>${food.name}</td>
    <td>${food.calories}</td>
    <td>${food.protein}g</td>
    <td>${food.carbs}g</td>
    <td>${food.fat}g</td>
    <td>${food.fiber}g</td>
  `;
  log.appendChild(row);

  if(saveConsumed){
    const existingLog = localStorage.getItem('foodLog');
    let logArray = existingLog ? JSON.parse(existingLog) : [];
    logArray.push(food);
    localStorage.setItem('foodLog', JSON.stringify(logArray));
    localStorage.setItem('consumed', JSON.stringify(consumed));
  }
}

function updateProgress(){
  document.getElementById("progress").innerHTML = `
    Calories: ${consumed.calories}/${goals.calories} (Left: ${goals.calories - consumed.calories})<br>
    Protein: ${consumed.protein}/${goals.protein}g (Left: ${goals.protein - consumed.protein}g)<br>
    Carbs: ${consumed.carbs}/${goals.carbs}g (Left: ${goals.carbs - consumed.carbs}g)<br>
    Fat: ${consumed.fat}/${goals.fat}g (Left: ${goals.fat - consumed.fat}g)<br>
    Fiber: ${consumed.fiber}/${goals.fiber}g (Left: ${goals.fiber - consumed.fiber}g)
  `;
}

function resetLog(){
  consumed = {calories:0, protein:0, carbs:0, fat:0, fiber:0};
  document.getElementById("foodLog").innerHTML = "";
  document.getElementById("foodLogTable").style.display = "none";
  localStorage.removeItem('foodLog');
  localStorage.removeItem('consumed');
  updateProgress();
}

// Water functions
function addWater(){
  const amount = parseInt(document.getElementById("waterInput").value);
  if(!amount) return alert("Please enter water in ml");
  water += amount;
  localStorage.setItem('water', water);
  updateWater();
  document.getElementById("waterInput").value = "";
}
function resetWater(){
  water = 0;
  localStorage.removeItem('water');
  updateWater();
}
function updateWater(){
  document.getElementById("waterProgress").innerText = `Total: ${water} ml`;
}
</script>
</body>
</html>
